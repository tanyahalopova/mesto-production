(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const Q=document.querySelector("#card-template").content;function N(e,t,o){const r=Q.querySelector(".places__item").cloneNode(!0),n=r.querySelector(".card__image"),c=r.querySelector(".card__title"),u=r.querySelector(".card__control-button_type_delete"),v=r.querySelector(".card__like-button"),L=r.querySelector(".card__like-count");n.src=e.link,n.alt=e.name,c.textContent=e.name,L&&(L.textContent=e.likes.length);const U=e.likes.some(G=>G._id===o);U&&v.classList.add("card__like-button_is-active"),e.owner._id!==o?u.remove():u.addEventListener("click",()=>t.onDeleteCard(e._id,r)),v.addEventListener("click",()=>t.onLikeIcon(e._id,v,L,U)),n.addEventListener("click",()=>t.onPreviewPicture(e));const A=r.querySelector(".card__control-button_type_info");return A&&A.addEventListener("click",()=>t.onInfoClick(e._id)),r}function X(e,t,o){e.classList.toggle("card__like-button_is-active"),t&&(t.textContent=o.length)}const O=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");l(t)}},p=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",O)},l=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",O)},Y=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{l(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&l(e)})},$=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)},R=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""},ee=(e,t,o)=>t.dataset.errorMessage&&!new RegExp(o.nameRegexPattern).test(t.value)?($(e,t,t.dataset.errorMessage,o),!1):t.validity.valid?(R(e,t,o),!0):($(e,t,t.validationMessage,o),!1),te=e=>e.some(t=>!t.validity.valid),q=(e,t,o)=>{te(e)?(t.classList.add(o.inactiveButtonClass),t.disabled=!0):(t.classList.remove(o.inactiveButtonClass),t.disabled=!1)},oe=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);q(o,r,t),o.forEach(n=>{n.addEventListener("input",()=>{ee(e,n,t),q(o,r,t)})})},re=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",r=>{r.preventDefault()}),oe(o,e)})},k=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{R(e,n,t)}),q(o,r,t)},s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"ded31197-d762-471f-9080-0596be5dd16f","Content-Type":"application/json"}},a=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ne=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(a),W=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(a),se=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(a),ce=({avatar:e})=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(a),ie=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(a),le=e=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(a),ae=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(a),H=document.querySelector(".places__list"),x=document.querySelector(".popup_type_edit"),h=x.querySelector(".popup__form"),V=h.querySelector(".popup__input_type_name"),j=h.querySelector(".popup__input_type_description"),I=document.querySelector(".popup_type_new-card"),d=I.querySelector(".popup__form"),ue=d.querySelector(".popup__input_type_card-name"),de=d.querySelector(".popup__input_type_url"),E=document.querySelector(".popup_type_image"),F=E.querySelector(".popup__image"),pe=E.querySelector(".popup__caption"),me=document.querySelector(".profile__edit-button"),_e=document.querySelector(".profile__add-button"),P=document.querySelector(".profile__title"),T=document.querySelector(".profile__description"),w=document.querySelector(".profile__image"),B=document.querySelector(".popup_type_edit-avatar"),y=B.querySelector(".popup__form"),fe=y.querySelector(".popup__input"),M=document.querySelector(".popup_type_remove-card"),ye=M.querySelector(".popup__form");let b=null,f=null,g;const _=document.querySelector(".popup_type_info"),he=_.querySelector(".popup__title"),D=_.querySelector(".popup__info"),Se=_.querySelector(".popup__text"),C=_.querySelector(".popup__list"),ve=document.querySelector("#popup-info-definition-template").content,Le=document.querySelector("#popup-info-user-preview-template").content,m=(e,t)=>{const o=ve.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},Ce=e=>new Date(e).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",nameRegexPattern:"^[A-Za-zА-Яа-я\\s\\-]+$"};re(S);const J=({name:e,link:t})=>{F.src=t,F.alt=e,pe.textContent=e,p(E)},qe=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;i(!0,t,o,"Сохранение..."),se({name:V.value,about:j.value}).then(r=>{P.textContent=r.name,T.textContent=r.about,l(x)}).catch(r=>{console.error("Ошибка при обновлении профиля:",r)}).finally(()=>{i(!1,t,o)})},be=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;i(!0,t,o,"Сохранение..."),ce({avatar:fe.value}).then(r=>{w.style.backgroundImage=`url(${r.avatar})`,l(B)}).catch(r=>{console.error("Ошибка при обновлении аватара:",r)}).finally(()=>{i(!1,t,o)})},ge=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;i(!0,t,o,"Создание..."),ie({name:ue.value,link:de.value}).then(r=>{H.prepend(N(r,{onPreviewPicture:J,onLikeIcon:z,onDeleteCard:K,onInfoClick:Z},g)),l(I),d.reset()}).catch(r=>{console.error("Ошибка при добавлении новой карточки:",r)}).finally(()=>{i(!1,t,o)})};h.addEventListener("submit",qe);d.addEventListener("submit",ge);y.addEventListener("submit",be);me.addEventListener("click",()=>{V.value=P.textContent,j.value=T.textContent,k(h,S),p(x)});w.addEventListener("click",()=>{y.reset(),k(y,S),p(B)});_e.addEventListener("click",()=>{d.reset(),k(d,S),p(I)});const ke=document.querySelectorAll(".popup");ke.forEach(e=>{Y(e)});function i(e,t,o="Сохранить",r="Сохранение..."){e?t.textContent=r:t.textContent=o}Promise.all([ne(),W()]).then(([e,t])=>{g=e._id,P.textContent=e.name,T.textContent=e.about,w.style.backgroundImage=`url(${e.avatar})`,t.forEach(o=>{H.append(N(o,{onPreviewPicture:J,onLikeIcon:z,onDeleteCard:K,onInfoClick:Z},g))})}).catch(e=>{console.error("Ошибка при загрузке данных:",e)});const z=(e,t,o,r)=>{ae(e,r).then(n=>{X(t,o,n.likes)}).catch(n=>{console.error("Ошибка при изменении статуса лайка:",n)})},K=(e,t)=>{b=e,f=t,p(M)},xe=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;i(!0,t,o,"Удаление..."),le(b).then(()=>{f&&f.remove(),l(M),b=null,f=null}).catch(r=>{console.error("Ошибка при удалении карточки:",r)}).finally(()=>{i(!1,t,o,"Да")})};ye.addEventListener("submit",xe);const Z=e=>{W().then(t=>{const o=t.find(r=>r._id===e);if(!o){console.error("Карточка не найдена.");return}if(D.innerHTML="",C.innerHTML="",he.textContent=o.name,D.append(m("Название:",o.name),m("Ссылка:",o.link),m("Автор:",o.owner.name),m("Дата создания:",Ce(o.createdAt)),m("Количество лайков:",o.likes.length)),Se.textContent=`Понравилось (${o.likes.length} человек):`,o.likes.length>0)o.likes.forEach(r=>{const n=Le.querySelector(".popup__list-item").cloneNode(!0);n.textContent=r.name,C.append(n)});else{const r=document.createElement("li");r.classList.add("popup__list-item"),r.textContent="Пока никто не лайкнул эту карточку.",C.append(r)}p(_)}).catch(t=>{console.error("Ошибка при получении данных о карточке:",t)})};
